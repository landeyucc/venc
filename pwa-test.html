<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA测试 - VENC</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- PWA 支持 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="VENC">
    <link rel="apple-touch-icon" href="img/venc.ico">
    <meta name="application-name" content="VENC">
    <meta name="mobile-web-app-capable" content="yes">
</head>
<body>
    <div class="card">
        <h1>PWA功能测试</h1>
        <div class="pwa-test-container">
            <h2>基本信息</h2>
            <p><strong>应用名称:</strong> VENC文件保护</p>
            <p><strong>版本:</strong> v1</p>
            
            <h2>PWA功能状态</h2>
            <div id="serviceWorkerStatus" class="status">
                正在检查Service Worker状态...
            </div>
            <div id="cachingStatus" class="status">
                正在检查缓存状态...
            </div>
            <div id="manifestStatus" class="status">
                正在检查Manifest状态...
            </div>
            
            <h2>功能说明</h2>
            <ul>
                <li>离线工作能力：应用可以在没有网络连接时使用</li>
                <li>桌面快捷方式：支持添加到主屏幕</li>
                <li>缓存管理：自动缓存应用资源</li>
                <li>响应式设计：适配不同屏幕尺寸</li>
            </ul>
        </div>
    </div>
    
    <script>
        // 检查Service Worker状态
        function checkServiceWorker() {
            const statusElement = document.getElementById('serviceWorkerStatus');
            
            if ('serviceWorker' in navigator) {
                statusElement.textContent = 'Service Worker 已支持';
                statusElement.style.color = '#4CAF50';
                
                navigator.serviceWorker.getRegistration().then(registration => {
                    if (registration) {
                        statusElement.textContent += '，且已注册';
                    }
                });
            } else {
                statusElement.textContent = 'Service Worker 不支持';
                statusElement.style.color = '#f44336';
            }
        }
        
        // 检查缓存状态
        function checkCaching() {
            const statusElement = document.getElementById('cachingStatus');
            
            if ('caches' in window) {
                statusElement.textContent = 'Cache API 已支持';
                statusElement.style.color = '#4CAF50';
                
                caches.keys().then(cacheNames => {
                    if (cacheNames.length > 0) {
                        statusElement.textContent += `，已缓存 ${cacheNames.length} 个资源集`;
                    }
                });
            } else {
                statusElement.textContent = 'Cache API 不支持';
                statusElement.style.color = '#f44336';
            }
        }
        
        // 检查Manifest状态
        function checkManifest() {
            const statusElement = document.getElementById('manifestStatus');
            const manifestLink = document.querySelector('link[rel="manifest"]');
            
            if (manifestLink) {
                statusElement.textContent = 'Manifest 文件已配置';
                statusElement.style.color = '#4CAF50';
            } else {
                statusElement.textContent = 'Manifest 文件未配置';
                statusElement.style.color = '#f44336';
            }
        }
        
        // 页面加载完成后执行检查
        window.addEventListener('load', () => {
            checkServiceWorker();
            checkCaching();
            checkManifest();
        });
    </script>
    
    <!-- 注册Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker 注册成功:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service Worker 注册失败:', error);
                    });
            });
        }
    </script>
</body>
</html>